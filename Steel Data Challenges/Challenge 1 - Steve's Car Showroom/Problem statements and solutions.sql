/* STEVE RUNS A TOP-END CAR SHOWROOM BUT HIS DATA ANALYST HAS JUST QUIT AND LEFT HIM WITHOUT HIS CRUCIAL INSIGHTS.
CAN YOU ANALYSE THE FOLLOWING DATA TO PROVIDE HIM WITH ALL THE ANSWERS HE REQUIRES? */

USE STEVE_CAR_SHOWROOM;

SELECT * FROM CARS;
SELECT * FROM SALES;
SELECT * FROM SALESPERSONS;

-- 1. WHAT ARE THE DETAILS OF ALL CARS PURCHASED IN THE YEAR 2022?
SELECT	C.CAR_ID, C.MAKE, C.TYPE, C.STYLE, C.COST_$,
		S.PURCHASE_DATE
FROM	CARS C
JOIN	SALES S
ON		C.CAR_ID = S.CAR_ID
WHERE	YEAR(PURCHASE_DATE) = 2022;


-- 2. WHAT IS THE TOTAL NUMBER OF CARS SOLD BY EACH SALESPERSON?
SELECT	SP.NAME,
		COUNT(S.SALE_ID) AS TOTAL_CARS_SOLD_BY_EACH_SALESPERSON 
FROM	SALESPERSONS SP
JOIN	SALES S
ON		SP.SALESMAN_ID = S.SALESMAN_ID
GROUP BY SP.NAME;	

-- 3. WHAT IS THE TOTAL REVENUE GENERATED BY EACH SALESPERSON?
SELECT	SP.NAME AS SALESPERSON_NAME,
		SUM(C.COST_$) AS TOTAL_REVENUE
FROM	SALESPERSONS SP
JOIN	SALES S
ON		SP.SALESMAN_ID = S.SALESMAN_ID
INNER JOIN CARS C
ON		S.CAR_ID = C.CAR_ID
GROUP BY SP.NAME
ORDER BY 2;


-- 4. WHAT ARE THE DETAILS OF THE CARS SOLD BY EACH SALESPERSON?
SELECT	SP.NAME,
		C.MAKE, C.STYLE, C.TYPE, C.COST_$
FROM	SALESPERSONS SP
JOIN	SALES S
ON		SP.SALESMAN_ID = S.SALESMAN_ID
JOIN	CARS C
ON		S.CAR_ID = C.CAR_ID
ORDER BY SP.NAME;


-- 5. WHAT IS THE TOTAL REVENUE GENERATED BY EACH CAR TYPE?
SELECT  C.TYPE,
		SUM(C.COST_$) AS TOTAL_REVENUE
FROM	CARS C
JOIN	SALES S
ON		C.CAR_ID = S.CAR_ID
GROUP BY TYPE;


-- 6. WHAT ARE THE DETAILS OF THE CARS SOLD IN THE YEAR 2021 BY SALESPERSON 'EMILY WONG'?
SELECT	SP.NAME,
		C.MAKE, C.TYPE, C.STYLE, C.COST_$
FROM	SALESPERSONS SP
JOIN	SALES S
ON		SP.SALESMAN_ID = S.SALESMAN_ID
JOIN	CARS C
ON		S.CAR_ID = C.CAR_ID
WHERE	YEAR(S.PURCHASE_DATE) = 2021 AND SP.NAME = 'EMILY WONG';


-- 7. WHAT IS THE TOTAL REVENUE GENERATED BY THE SALES OF HATCHBACK CARS?
SELECT	SUM(C.COST_$) AS TOTAL_HATCHBACK_REVENUE
FROM	CARS C
JOIN	SALES S
ON		C.CAR_ID = S.CAR_ID
WHERE	C.STYLE = 'HATCHBACK';


-- 8. WHAT IS THE TOTAL REVENUE GENERATED BY THE SALES OF SUV CARS IN THE YEAR 2022?
SELECT	SUM(C.COST_$) AS TOTAL_REVENUE
FROM	CARS C
JOIN	SALES S
ON		C.CAR_ID = S.CAR_ID
WHERE	YEAR(S.PURCHASE_DATE) = 2022 AND C.STYLE = 'SUV';


-- 9. WHAT IS THE NAME AND CITY OF THE SALESPERSON WHO SOLD THE MOST NUMBER OF CARS IN THE YEAR 2023?
SELECT	TOP 1 
		SP.NAME, SP.CITY,
		COUNT(S.CAR_ID) AS NUMBER_OF_CARS_SOLD
FROM	SALESPERSONS SP
JOIN	SALES S
ON		SP.SALESMAN_ID = S.SALESMAN_ID
WHERE	YEAR(S.PURCHASE_DATE) = 2023
GROUP BY SP.NAME, SP.CITY
ORDER BY NUMBER_OF_CARS_SOLD DESC;


-- 10. WHAT IS THE NAME AND AGE OF THE SALESPERSON WHO GENERATED THE HIGHEST REVENUE IN THE YEAR 2022?
SELECT	TOP 1
		SP.NAME, SP.AGE,
		SUM(C.COST_$) AS HIGHEST_REVENUE
FROM	SALESPERSONS SP
JOIN	SALES S
ON		SP.SALESMAN_ID = S.SALESMAN_ID
JOIN	CARS C
ON		S.CAR_ID = C.CAR_ID
GROUP BY SP.NAME,SP.AGE
ORDER BY HIGHEST_REVENUE DESC;